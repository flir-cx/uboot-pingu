/*
 * Copyright (C) 2019 FLIR Systems.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.

 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.

 * You should have received a copy of the GNU General Public License along
 * with this program; if not, write to the Free Software Foundation, Inc.,
 * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
 */
#include <common.h>
/* #include <imx_mipi_dsi_bridge.h> */
#include <mipi_display.h>


struct reg_value {
	u8	command; // mipi command
	u8  delay; //delay in ms
	u8 	buf_size; //buffer size for long commands, for short set it to 0
	u8	buf[60];
};

static struct reg_value lcd_setup[] =
{
//	{0x15,0, 0,{0x35,0x01}}, //Tearing ON
	{0x29,0, 4,{0xB9,0xFF,0x83,0x94}}, //SETEXTC  extended command set access enable
	{0x29,0,11,{0xB1,0x48,0x14,0x74,0x09,0x33,0x54,0x71,0x31,0x4D,0x2F}},  //SETPOWER
	{0x29,0, 7,{0xBA,0x61,0x03,0x68,0x6B,0xB2,0xC0}}, //SETMIPI MIPI control: dsi 2-lane
	//SETCYC display waveform cycles
	{0x29,0,22,{0xB4,0x01,0x70,0x01,0x70,0x01,0x70,0x01,0x0C,0x76,0x35,0x00,0x3F,0x01,\
			0x70,0x01,0x70,0x01,0x70,0x01,0x0C,0x76}},
	//SETGIP_0 GIP Option0
	{0x29,0,34,{0xD3,0x00,0x00,0x00,0x00,0x08,0x08,0x00,0x00,0x32,0x10,0x03,0x00,0x03,\
			0x32,0x11,0xE9,0x01,0xE9,0x32,0x10,0x08,0x00,0x00,0x37,0x03,0x05,0x05,0x37,0x05,0x05,0x17,0x06,0x40}},
	//SETDISP Display related register: Resolution=640RGB, Lines=480, Vertical Back Porch=12, Vertical Front Porch=13,
	// Line Blank=352 TCON CLK
	{0x29,0, 7,{0xB2,0x00,0x90,0x00,0x0C,0x0D,0xFF}},
	//{0x29,0,0,0,0, 12,{0xB2,0x00,0x90,0x00,0x0C,0x0D,0xFF, 0x0,0x0,0x0,0x0,0x78}}, //Test Pattern
	{0x29,0, 8,{0xBF,0x40,0x81,0x50,0x00,0x1A,0xFC,0x01}}, //??
	//SETGIP_1 GIP Option1
	{0x29,0,45,{0xD5,0x18,0x18,0x24,0x25,0x19,0x19,0x18,0x18,0x18,0x18,0x06,0x07,0x04,\
			0x05,0x02,0x03,0x00,0x01,0x20,0x21,0x18,0x18,0x18,0x18,0x18,0x18,0x18,\
			0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18}},
	//SETGIP_2 GIP Option2
	{0x29,0,45,{0xD6,0x19,0x19,0x21,0x20,0x18,0x18,0x18,0x18,0x18,0x18,0x01,0x00,0x03,\
			0x02,0x05,0x04,0x07,0x06,0x25,0x24,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,\
			0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18}},

	//SETGAMMA gamma curve related setting
	{0x29,0,59,{0xE0,0x00,0x13,0x20,0x27,0x2C,0x2F,0x30,0x30,0x5E,0x6D,0x7C,0x78,0x7F,\
			0x8E,0x92,0x94,0xA1,0xA4,0xA0,0xAE,0xBB,0x5C,0x59,0x5D,0x60,0x63,0x67,0x73,\
			0x7F,0x00,0x13,0x20,0x27,0x2C,0x2F,0x30,0x30,0x5E,0x6D,0x7C,0x78,0x7F,0x8E,\
			0x92,0x94,0xA1,0xA4,0xA0,0xAE,0xBB,0x5C,0x59,0x5D,0x60,0x63,0x67,0x73,0x7F}},
	//SETPANEL panel related register: BGR_PANEL=1, GS_PANEL=1, reverse scan. SS_PANEL=1, shift direction from S3240 to S1
	{0x29,0, 2,{0xCC,0x0B}},
	{0x29,0, 3,{0xC0,0x1F,0x31}},  //SETSTBA Source Option
	{0x29,0, 3,{0xB6,0x20,0x20}}, //SETVCOM VCOM voltage
	{0x15,0, 0,{0xD4,0x02}}, //SETIOOPT Set I/O Option
	{0x15,0, 0,{0xD2,0x77}}, //SETOFFSET
	{0x15,0, 0,{0xC6,0xED}}, //??
	{0x05,150,0,{0x11}}, //Sleep out
	{0x05,50,0,{0x29}} //Display on
};


int mipid_hx8394_lcd_setup(struct mipi_dsi_client_dev *panel_dev)
{
	int i;
	debug("MIPI DSI LCD HX8363 setup.\n");

	for(i=0;i<ARRAY_SIZE(lcd_setup);i++)
	{
		/* imx_mipi_dsi_bridge_pkt_write(lcd_setup[i].command, */
		/* 			(u32*) lcd_setup[i].buf, lcd_setup[i].buf_size); */
		mdelay(lcd_setup[i].delay);
	}
	return 0;
}

/* static struct mipi_dsi_client_driver hx8394_drv = { */
/* 	.name = "TRULY-VGA-SHERLOCK", */
/* 	.dsi_client_setup = mipid_hx8394_lcd_setup, */
/* }; */

void hx8394_init(void)
{
	/* imx_mipi_dsi_bridge_add_client_driver(&hx8394_drv); */
}
